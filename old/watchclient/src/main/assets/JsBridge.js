!function(a){"use strict";var b,c=a.Base64,d="2.1.5";"undefined"!=typeof module&&module.exports&&(b=require("buffer").Buffer);var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=function(a){for(var b={},c=0,d=a.length;c<d;c++)b[a.charAt(c)]=c;return b}(e),g=String.fromCharCode,h=function(a){if(a.length<2){var b=a.charCodeAt(0);return b<128?a:b<2048?g(192|b>>>6)+g(128|63&b):g(224|b>>>12&15)+g(128|b>>>6&63)+g(128|63&b)}var b=65536+1024*(a.charCodeAt(0)-55296)+(a.charCodeAt(1)-56320);return g(240|b>>>18&7)+g(128|b>>>12&63)+g(128|b>>>6&63)+g(128|63&b)},i=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,j=function(a){return a.replace(i,h)},k=function(a){var b=[0,2,1][a.length%3],c=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),d=[e.charAt(c>>>18),e.charAt(c>>>12&63),b>=2?"=":e.charAt(c>>>6&63),b>=1?"=":e.charAt(63&c)];return d.join("")},l=a.btoa?function(b){return a.btoa(b)}:function(a){return a.replace(/[\s\S]{1,3}/g,k)},m=b?function(a){return new b(a).toString("base64")}:function(a){return l(j(a))},n=function(a,b){return b?m(a).replace(/[+\/]/g,function(a){return"+"==a?"-":"_"}).replace(/=/g,""):m(a)},o=function(a){return n(a,!0)},p=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),q=function(a){switch(a.length){case 4:var b=(7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3),c=b-65536;return g((c>>>10)+55296)+g((1023&c)+56320);case 3:return g((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return g((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},r=function(a){return a.replace(p,q)},s=function(a){var b=a.length,c=b%4,d=(b>0?f[a.charAt(0)]<<18:0)|(b>1?f[a.charAt(1)]<<12:0)|(b>2?f[a.charAt(2)]<<6:0)|(b>3?f[a.charAt(3)]:0),e=[g(d>>>16),g(d>>>8&255),g(255&d)];return e.length-=[0,0,2,1][c],e.join("")},t=a.atob?function(b){return a.atob(b)}:function(a){return a.replace(/[\s\S]{1,4}/g,s)},u=b?function(a){return new b(a,"base64").toString()}:function(a){return r(t(a))},v=function(a){return u(a.replace(/[-_]/g,function(a){return"-"==a?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},w=function(){var b=a.Base64;return a.Base64=c,b};if(a.Base64={VERSION:d,atob:t,btoa:l,fromBase64:v,toBase64:n,utob:j,encode:n,encodeURI:o,btou:r,decode:v,noConflict:w},"function"==typeof Object.defineProperty){var x=function(a){return{value:a,enumerable:!1,writable:!0,configurable:!0}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",x(function(){return v(this)})),Object.defineProperty(String.prototype,"toBase64",x(function(a){return n(this,a)})),Object.defineProperty(String.prototype,"toBase64URI",x(function(){return n(this,!0)}))}}}(this),this.Meteor&&(Base64=global.Base64),function(){"use strict";var a,b,c=[],d=1e3,e={},f={},g={},h="milive",i="__msg_type",j="__callback_id",k="__event_id",l="dispatch_message/",m=function(){return b=document.createElement("iframe"),b.id="__miLiveJsBridgeIframe_setResult",b.style.display="none",document.documentElement.appendChild(b),a=document.createElement("iframe"),a.id="__miLiveJsBridgeIframe",a.style.display="none",document.documentElement.appendChild(a),a},n=function(b){b&&(c.push(b),a.src=h+"://"+l)},o=function(){var a=JSON.stringify(c);c=[],p("SCENE_FETCHQUEUE",a)},p=function(a,c){void 0===c&&(c="none"),b.src=h+"://private/setresult/"+a+"&"+Base64.encode(c)},q=function(a,b,c,f){if(a&&"string"==typeof a){"object"!=typeof b&&(b={});var g=(d++).toString();"function"==typeof c&&(e[g]={cb:c,ctx:f||this});var h={func:a,params:b};h[i]="call",h[j]=g,n(h)}},r=function(a){a&&q("show_log",a)},s=function(a,b,c){a&&"string"==typeof a&&"function"==typeof b&&(f[a]={cb:b,ctx:c||this})},t=function(a,b){var c=f[a];"function"==typeof c.cb&&c.cb.apply(c.ctx,[b])},u=function(a){if(a){var b,c,d,g={};switch(b=JSON.parse(Base64.decode(a)),g[i]=b[i],b[i]){case"callback":return g[j]=b[j],c=e[b[j]],"string"==typeof b[j]&&"function"==typeof c.cb?(g.result=c.cb.call(c.ctx,b.__params),delete e[b[j]],void p("SCENE_HANDLEMSGFROMCLIENT",JSON.stringify(g))):(g.__err_code="cb404",void p("SCENE_HANDLEMSGFROMCLIENT",JSON.stringify(g)));case"event":return g[k]=b[k],d=f[b[k]],"string"==typeof b[k]&&"function"==typeof d.cb?(g.result=d.cb.call(d.ctx,b.__params),void p("SCENE_HANDLEMSGFROMCLIENT",JSON.stringify(g))):(g.__err_code="ev404",void p("SCENE_HANDLEMSGFROMCLIENT",JSON.stringify(g)))}}},v=function(a){return g[a]},w=function(){t("sys:init",{}),t("sys:bridged",{})},x=function(){"onhashchange"in window&&(window.onhashchange=function(){q("hashChange",{hash:window.location.hash})})},y=function(){return g},z=function(){g&&g.env&&g.env.isDebug&&A()},A=function(){var a=document.createElement("div");a.id="__jb_info_tip",a.innerHTML=' <span class="_close" ontouchend="javascript:document.querySelector(\'#__jb_info_tip\').style[\'display\']=\'none\';"></span><div id="__jb_tip_cont" class="_cont"></div>',document.body.appendChild(a);var b=document.createElement("div");b.id="__jb_btn",b.innerHTML=' <span ontouchend="javascript: window.location.reload();">刷新</span>',document.body.appendChild(b);var c=document.createElement("style");c.type="text/css";var d="#__jb_info_tip,#__jb_btn{z-index:100;position:absolute;top:0;right:0;color:#fff;background-color:rgba(0,0,0,.4);padding:5% 4% 3%;margin:0;border-radius:0 0 5px 5px}#__jb_info_tip ._close{width:20px;height:20px;border-radius:50%;position:absolute;top:4px;left:4px}#__jb_info_tip ._close:before,#__jb_info_tip ._close:after{content:'';position:absolute;height:1px;width:100%;top:50%;left:0;margin-top:-1px;background:#fff}#__jb_info_tip ._close:before{transform:rotate(-45deg)}#__jb_info_tip ._close:after{transform:rotate(45deg)}#__jb_info_tip ._cont{margin:12px 0 10px}#__jb_btn{left: 2%; width: 20%;top: 2%;padding: 0;font-size: 1.2rem;text-align: center;}#__jb_btn span{background: rgba(0,0,0,0.5);padding: 10%;display: block;}";try{c.appendChild(document.createTextNode(d))}catch(e){c.styleSheet.cssText=d}document.head.appendChild(c)},B=function(a){if(g&&g.env&&g.env.isDebug){var b=g.env.stampTime||(new Date).getTime(),c=(new Date).getTime(),d=document.querySelector("#__jb_tip_cont"),e=d.innerHTML||"debug model:<br/>";d.innerHTML=e+"<br/>"+(a||"")+(c-b)+"ms"}},C=function(){s("sys:init",function(){window.JsBridge._hasInit||(window.JsBridge._hasInit=!0,q("get_session_data",{},function(a){g=a,z();var b=document.createEvent("Events");b.initEvent("JsBridgeReady"),document.dispatchEvent(b)}))}),s("sys:bridged",function(){window.JsBridge._hasInit||x()}),s("sys:refresh",function(a){q("get_session_data",{},function(a){g=a;var b=document.createEvent("Events");b.initEvent("JsBridgeRefresh"),document.dispatchEvent(b)})})};window.JsBridge=window.JsBridge||function(){return m(),C(),{version:"0.0.1",invoke:q,on:s,env:v,debugTime:B,log:r,_init:w,_fetchQueue:o,_handleMessageFromClient:u,getSessionData:y,_hasInit:!1}}()}(),function(){var a=window.clientApi={},b=function(a){var b=typeof a;if(!("function"===b||"object"===b&&a))return a;for(var c,d,e=0,f=arguments.length;e<f;e++){c=arguments[e];for(d in c)hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};a.showToolBar=function(){JsBridge.invoke("showToolBar")},a.hideToolBar=function(){JsBridge.invoke("hideToolBar")},a.copy=function(a,b){if(a&&"string"==typeof a){var c={text:a};JsBridge.invoke("copy",c,b)}},a.openBrowser=function(a,b){var c={url:a||window.location.href};b=b||function(){},JsBridge.invoke("openInBrowser",c,b)},a.enableDebugMode=function(a){window.onerror=function(b,c,d,e){if("function"==typeof a)return void a({message:b,script:c,line:d,column:e});var f=[];f.push("额，代码有错。。。"),f.push("\n错误信息：",b),f.push("\n出错文件：",c),f.push("\n出错位置：",d+"行，"+e+"列"),alert(f.join(""))}};var c=function(a){var b=!1,c=function(c){b||(b=!0,a(c))},d=document.getElementsByTagName("img");if(!d.length)return c();var e,f,g,h,i={},j=!1;for(f=0,g=d.length;f<g;f++)e=d[f],"none"!=e.style.display&&"hidden"!=e.style.visibility&&(i[e.src]||(i[e.src]=1,h=new Image,h.onload=function(){j||this.width>290&&this.height>290&&(j=!0,c(this))},h.src=e.src));i=null,setTimeout(function(){j||c()},1e3)};a.share=function(a,b){var d;if(d="string"==typeof a.title?a:{link:document.documentURI,desc:document.documentURI,title:document.title},b=b||function(){},a.imgUrl)return d.img_url=a.imgUrl,void JsBridge.invoke("share",d,b);var e=function(a){a&&(d.img_url=a.src),JsBridge.invoke("share",d,b)};c(e)},a.videoPlay=function(a,b,c){JsBridge.invoke("video_play",{url:a,title:b},c)},a.inputTxtByNative=function(a,b){JsBridge.invoke("input_text",{btnText:a},b)},a.nativeRequest=function(a,b){if(""!==a.url&&""!==a.type){var c={url:a.url,param:a.param||{},http_method:a.http_method||"get",secertKey:a.secertKey||"",type:a.type};JsBridge.invoke("native_request",c,b)}},a.showDialog=function(a,c){var d={type:"show:txt",title:"",content:"",isLazyClose:!1,lazyTime:0,isShowCancelBtn:!1,cancelBtnTxt:"取消",isShowOkBtn:!1,okBtnTxt:"确定"},e=function(a){if(a&&a.operat)switch(a.operat){case"ok":c.ok&&c.ok(a.content);break;case"cancel":c.cancel&&c.cancel(a.content)}};d=b(d,a),d.type.indexOf("submit")>-1&&(d.isLazyClose=!1),JsBridge.invoke("show_dialog",d,e)},a.uploadImg=function(a){JsBridge.invoke("upload_img",{},a)},a.uploadVideo=function(a){JsBridge.invoke("upload_video",{},a)},a.takePhoto=function(a){JsBridge.invoke("take_photo",{},a)},a.takeVideo=function(a){JsBridge.invoke("take_video",{},a)},a.clientLog=function(a){JsBridge.invoke("show_log",a)},a.historyNotRecords=function(a){JsBridge.invoke("history_not_records",{},a)},a.historyJumpOutWebview=function(a){JsBridge.invoke("history_jumpout_webview",{},a)},a.goBack=function(a){JsBridge.invoke("web_go_back",{},a)},a.viewImgList=function(a,b){var c={images:a.images||[],curIndex:a.curIndex||0};c.images.length&&JsBridge.invoke("view_img_list",c,b)},a.getSessionData=function(){return JsBridge.getSessionData()},a.executeClientMethod=function(a,b,c,d){JsBridge.invoke("client_method_execute",{method:a,param:b},function(a){c&&c.call(d,a)},d)},a.closeWebview=function(a,b){a||(a={type:"close"});var c={type:a.type||"close"};JsBridge.invoke("close_webview",c,b)},a.hideLoading=function(a,b){a||(a={type:"hide"});var c={type:a.type||"hide"};JsBridge.invoke("hide_loading",c,b)},a.openLive=function(a){JsBridge.invoke("open_live",{},a)},a.version=3}();